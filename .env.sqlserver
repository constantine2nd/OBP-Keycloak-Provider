# OBP Keycloak Provider Environment Configuration - SQL Server Setup
# This configuration uses:
# - PostgreSQL for Keycloak's internal database (realms, users, clients, etc.)
# - SQL Server for User Storage (OBP user data federation)

# =============================================================================
# KEYCLOAK ADMIN CONFIGURATION
# =============================================================================
KEYCLOAK_ADMIN=admin
KEYCLOAK_ADMIN_PASSWORD=admin

# =============================================================================
# KEYCLOAK'S INTERNAL DATABASE CONFIGURATION (PostgreSQL)
# This database stores Keycloak's realm data, users, clients, tokens, etc.
# =============================================================================
KC_DB_NAME=keycloak
KC_DB_USERNAME=keycloak
KC_DB_PASSWORD=secure_keycloak_db_password
KC_DB_PORT=5433

# Full JDBC URL for Keycloak's database (PostgreSQL)
KC_DB_URL=jdbc:postgresql://host.docker.internal:5433/keycloak

# =============================================================================
# USER STORAGE DATABASE CONFIGURATION (SQL Server)
# This database contains the external user data that Keycloak federates
# =============================================================================
DB_NAME=obp_mapped
DB_PORT=1433
DB_USER=oidc_user
DB_PASSWORD=your_db_password

# Full JDBC URL for User Storage database (SQL Server)
DB_URL=jdbc:sqlserver://host.docker.internal:1433;databaseName=obp_mapped

# User Storage Database Configuration
DB_AUTHUSER_TABLE=v_oidc_users
OBP_AUTHUSER_PROVIDER=obp_development

# Database driver configuration
DB_DRIVER=com.microsoft.sqlserver.jdbc.SQLServerDriver
DB_DIALECT=org.hibernate.dialect.SQLServerDialect

# =============================================================================
# HIBERNATE CONFIGURATION (for User Storage)
# =============================================================================
HIBERNATE_DDL_AUTO=validate
HIBERNATE_SHOW_SQL=true
HIBERNATE_FORMAT_SQL=true

# =============================================================================
# KEYCLOAK RUNTIME CONFIGURATION
# =============================================================================
KC_HOSTNAME_STRICT=false
KC_HOSTNAME_STRICT_HTTPS=false
KC_HTTP_ENABLED=true
KC_HEALTH_ENABLED=true
KC_METRICS_ENABLED=true
KC_FEATURES=token-exchange

# =============================================================================
# NETWORK PORTS
# =============================================================================
KEYCLOAK_HTTP_PORT=7787
KEYCLOAK_HTTPS_PORT=8443

# DATABASE PORTS (External Access)
KC_DB_PORT=5433          # Keycloak's PostgreSQL database
DB_PORT=1433             # User Storage SQL Server database

# =============================================================================
# DATABASE HOST CONFIGURATION
# =============================================================================
DB_HOST=localhost
KEYCLOAK_HOST=localhost

# =============================================================================
# OPTIONAL: PGADMIN CONFIGURATION (for PostgreSQL management)
# =============================================================================
KEYCLOAK_PGADMIN_EMAIL=keycloak-admin@obp.com
KEYCLOAK_PGLADMIN_PASSWORD=admin
KEYCLOAK_PGADMIN_PORT=5051

# =============================================================================
# SQL SERVER CONFIGURATION NOTES
# =============================================================================
# Ensure your SQL Server instance:
# 1. Has TCP/IP enabled
# 2. Accepts connections on port 1433
# 3. Has SQL Server Authentication enabled
# 4. User 'oidc_user' exists with proper permissions
# 5. Database 'obp_mapped' exists
# 6. Required tables/views are available (v_oidc_users)
#
# Example SQL Server setup commands:
# CREATE DATABASE obp_mapped;
# CREATE LOGIN oidc_user WITH PASSWORD = 'markoM123*milic';
# USE obp_mapped;
# CREATE USER oidc_user FOR LOGIN oidc_user;
# GRANT SELECT ON v_oidc_users TO oidc_user;
