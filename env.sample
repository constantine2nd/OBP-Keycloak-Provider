# OBP Keycloak Provider Environment Configuration
# Copy this file to .env and customize for your environment

# =============================================================================
# KEYCLOAK ADMIN CONFIGURATION
# =============================================================================
KEYCLOAK_ADMIN=admin
KEYCLOAK_ADMIN_PASSWORD=secure_admin_password

# =============================================================================
# KEYCLOAK'S INTERNAL DATABASE CONFIGURATION
# This database stores Keycloak's realm data, users, clients, tokens, etc.
# =============================================================================
KC_DB_NAME=keycloak
KC_DB_USERNAME=keycloak
KC_DB_PASSWORD=secure_keycloak_db_password
KC_DB_PORT=5433

# Full JDBC URL for Keycloak's own internal database
# KC_DB_URL=jdbc:postgresql://keycloak-postgres:5432/keycloak

# =============================================================================
# OBP API CONFIGURATION
# The provider authenticates users via OBP REST API endpoints instead of
# direct database access.
#
# Required roles on OBP_API_USERNAME:
#   CanGetAnyUser              — user lookup by username / ID
#   CanVerifyUserCredentials   — credential verification at login
#   CanGetOidcClient           — OIDC client verification
#
# Optional roles:
#   CanGetProviders            — provider listing
# =============================================================================

# Base URL of your OBP API instance (no trailing slash)
OBP_API_URL=http://localhost:8080

# Admin OBP user that holds the required roles above
OBP_API_USERNAME=admin_user
OBP_API_PASSWORD=admin_password

# Consumer key registered in OBP for Direct Login
OBP_API_CONSUMER_KEY=your_consumer_key

# MANDATORY: Provider name used to filter users.
# Only users whose OBP provider field matches this value will be authenticated.
# This variable is REQUIRED — the system will refuse to start if it is not set.
# Example values: obp_production, obp_development, tenant_a
OBP_AUTHUSER_PROVIDER=your_provider_name

# =============================================================================
# KEYCLOAK RUNTIME CONFIGURATION
# =============================================================================
KC_HOSTNAME_STRICT=false
KC_HOSTNAME_STRICT_HTTPS=false
KC_HTTP_ENABLED=true
KC_HEALTH_ENABLED=true
KC_METRICS_ENABLED=true
KC_FEATURES=token-exchange

# =============================================================================
# THEME CUSTOMIZATION
# =============================================================================
# Override the "Forgot Password?" link on the login page.
# Set to an external URL to redirect users to a custom password reset page.
# Leave empty to use Keycloak's built-in password reset flow.
FORGOT_PASSWORD_URL=

# =============================================================================
# NETWORK PORTS
# =============================================================================
KEYCLOAK_HTTP_PORT=7787
KEYCLOAK_HTTPS_PORT=8443
KEYCLOAK_MGMT_PORT=9000

KC_DB_PORT=5433          # Keycloak's internal database

# =============================================================================
# PGADMIN CONFIGURATION (Optional — for Keycloak internal DB only)
# =============================================================================
KEYCLOAK_PGADMIN_EMAIL=keycloak-admin@obp.com
KEYCLOAK_PGLADMIN_PASSWORD=admin
KEYCLOAK_PGADMIN_PORT=5051

# =============================================================================
# PRODUCTION EXAMPLES
# =============================================================================

# Example for external Keycloak database (managed PostgreSQL service):
# KC_DB_URL=jdbc:postgresql://keycloak-prod.example.com:5432/keycloak
# KC_DB_USERNAME=keycloak_prod_user
# KC_DB_PASSWORD=very_secure_keycloak_password

# Example for production OBP API:
# OBP_API_URL=https://api.obp-prod.example.com
# OBP_API_USERNAME=keycloak_admin
# OBP_API_PASSWORD=very_secure_api_password
# OBP_API_CONSUMER_KEY=prod_consumer_key_abc123
# OBP_AUTHUSER_PROVIDER=production_provider   # MANDATORY — must be set

# =============================================================================
# TROUBLESHOOTING
# =============================================================================
# If the provider fails to start, check Keycloak logs for messages starting with
# "FATAL:" — these indicate missing mandatory environment variables.
#
# Common issues:
#   - "OBP_AUTHUSER_PROVIDER is not set"  → set the variable above
#   - "Unable to connect to OBP API"       → check OBP_API_URL and that the OBP
#                                            instance is running and reachable
#   - HTTP 401 on token fetch              → check OBP_API_USERNAME / PASSWORD /
#                                            CONSUMER_KEY
#   - Users not found at login             → confirm OBP_AUTHUSER_PROVIDER matches
#                                            the provider stored in OBP for those users
